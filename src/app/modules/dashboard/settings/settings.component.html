<div class="wrapper">
  <div class="main-div w-100 organization-details-div bg-white  p-3 ps-4 custom-shadow"
    *ngIf="this.localStoreService.getUserRole().toLowerCase() === 'master'">
    <div class="d-flex">
      <div class="iis-logo">
        <img class="rounded" [src]="localStoreService.getUserProfile()" height="64px" alt="iis">
      </div>
      <div class="ms-3">
        <div class="fs-20px fw-700 color-16192C bold-fonts">
          {{localStoreService.getUserName()}}
        </div>
        <div class="d-flex mt-1">
          <div class="d-flex">
            <div>
              <img src="../../../../../assets/icons/Frame.svg" alt="">
            </div>
            <div class="ms-1">
              <span class="color-8492A6 fs-14px semi-bold-fonts">{{localStoreService.getUserEmail()}}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="main-div w-100 organization-details-div bg-white  p-3 ps-4 custom-shadow"
  *ngIf="this.localStoreService.getUserRole().toLowerCase() !== 'master'">
  <div class="d-flex">
    <div class="iis-logo">
      <img class="rounded" [src]="localStoreService.getUserOrganizationLogo()" height="64px" alt="iis">
    </div>
    <div class="ms-3">
      <div class="fs-20px fw-700 color-16192C bold-fonts">
        {{localStoreService.getUserOrganizationName()}}
      </div>
      <div class="d-flex mt-1">
        <div class="d-flex">
          <div>
            <img src="../../../../../assets/icons/Frame.svg" alt="">
          </div>
          <div class="ms-1">
            <span class="color-8492A6 fs-14px semi-bold-fonts">{{localStoreService.getUserOrganizationDomain()}}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

  <div class="col-8 mt-4 w-100">
    <div class="d-flex justify-content-start">
      <nav class="mb-3 nav-tabs">
        <div class="nav nav-tabs fs-14px fw-600 semi-bold-fonts" id="nav-tab" role="tablist">
          <button (click)="setSelectedTab('account')" class="nav-link border-top-0 border-start-0 border-end-0"
            [ngClass]="'active-nav-tab'" [ngClass]="{'active-nav-tab': selectedTab === 'account'}" id="nav-account-tab"
            data-bs-toggle="tab" data-bs-target="#nav-account" type="button" role="tab" aria-controls="nav-account"
            [attr.aria-selected]="selectedTab === 'account'">
            Account
          </button>
          <button *ngIf="this.localStoreService.getUserRole().toLowerCase() === 'owner'"
            (click)="setSelectedTab('organization')" class="nav-link border-top-0 border-start-0 border-end-0"
            [ngClass]="{'active-nav-tab': selectedTab === 'organization'}" id="nav-organization-tab"
            data-bs-toggle="tab" data-bs-target="#nav-organization" type="button" role="tab"
            aria-controls="nav-organization" [attr.aria-selected]="selectedTab === 'organization'">
            Organization
          </button>
          <button (click)="setSelectedTab('security')" class="nav-link border-top-0 border-start-0 border-end-0"
            [ngClass]="{'active-nav-tab': selectedTab === 'security'}" id="nav-monthly-tab" data-bs-toggle="tab"
            data-bs-target="#nav-monthly" type="button" role="tab" aria-controls="nav-monthly"
            [attr.aria-selected]="selectedTab === 'security'">
            Security
          </button>
        </div>
      </nav>
    </div>
    <hr class="line">
  </div>


  <div class="tabs-div bg-white custom-shadow">
    <div id="features-tab" *ngIf="selectedTab === 'account'">
      <div class="main-div w-100  account-tab">
        <div>
          <div class="main-div">
            <h4 class="fs-20px fw-700 mb-3">Account Details</h4>
            <form [formGroup]="accountDetailsForm" (ngSubmit)="onAccountDetailsSubmit()" class="">
              <div class="d-block d-md-flex justify-content-between">
                <div class="mb-4 custom-input w-100 me-4 position-relative"
                  [ngClass]="isControlHasError('firstName', 'required', accountDetailsForm) ? 'custom-input-error': 'custom-input'"
                  [ngClass]="{'disabled-input':!isEdited}">
                  <label for="first-name" class="form-label mb-1 fs-14px fw-700 required">First Name
                  </label>
                  <input type="text" class="form-control fs-14px" id="first-name"
                    placeholder="Enter first name" formControlName="firstName" [readOnly]="!isEdited"
                    [ngClass]="{'pointer-none disabled focus-none': !isEdited}">
                  <div class="error-message">
                    <small *ngIf="isControlHasError('firstName','required', accountDetailsForm)"
                      class="mt-1 text-danger">First
                      Name is
                      required</small>
                  </div>
                </div>
                <div class="mb-4 custom-input w-100 position-relative"
                  [ngClass]="isControlHasError('lastName', 'required', accountDetailsForm) ? 'custom-input-error': 'custom-input'"
                  [ngClass]="{'disabled-input':!isEdited}">
                  <label for="last-name" class="form-label mb-1 fs-14px fw-700 required ">Last Name
                  </label>
                  <input type="text" class="form-control fs-14px" id="last-name"
                    placeholder="Enter last name" formControlName="lastName" [readOnly]="!isEdited"
                    [ngClass]="{'pointer-none disabled focus-none': !isEdited}">
                  <small *ngIf="isControlHasError('lastName','required', accountDetailsForm)"
                    class="mt-1 text-danger">Last
                    Name is
                    required</small>
                </div>

              </div>
              <div class="d-block d-md-flex justify-content-between position-relative">
                <div class="mb-4 custom-input w-100 me-4 position-relative"
                  [ngClass]="isControlHasError('username', 'required', accountDetailsForm) ? 'custom-input-error': 'custom-input'"
                  [ngClass]="{'disabled-input':!isEdited}">
                  <label for="username" class="form-label mb-1 fs-14px fw-700 required">User Name
                  </label>
                  <input type="text" class="form-control fs-14px" id="username"
                    placeholder="Enter username" formControlName="username" [readOnly]="!isEdited"
                    [ngClass]="{'pointer-none disabled focus-none': !isEdited}">
                  <small *ngIf="isControlHasError('username','required', accountDetailsForm)"
                    class=" mt-1 text-danger">Username is required</small>
                </div>
                <div class="mb-4 custom-input w-100 position-relative"
                  [ngClass]="isControlHasError('phone', 'required', accountDetailsForm) ? 'custom-input-error': 'custom-input'"
                  [ngClass]="{'disabled-input':!isEdited}">
                  <label for="phone-number" class="form-label mb-1 fs-14px fw-700 required">Phone Number
                  </label>
                  <input type="number" inputmode="tel" class="form-control fs-14px" id="phone-number"
                    placeholder="Enter phone number" formControlName="phone" [disabled]="!isEdited" [readOnly]="!isEdited"
                    [ngClass]="{'pointer-none disabled focus-none': !isEdited}">
                  <small *ngIf="isControlHasError('phone','required', accountDetailsForm)"
                    class="mt-1 text-danger">Phone number required</small>
                </div>

              </div>
              <div class="d-block d-md-flex justify-content-between">
                <div class="mb-4 w-100 me-4 disabled-input">
                  <label for="email" class="form-label mb-1 fs-14px fw-700 required">Email </label>
                  <input type="text" class="form-control fs-14px pointer-none" id="email"
                    placeholder="" formControlName="email" [readOnly]="true">
                  <!-- <small *ngIf="isControlHasError('email','required', accountDetailsForm)" class="text-danger">First
                    Name is
                    required</small> -->
                </div>
                <div class="mb-4 w-100 disabled-input">
                  <label for="role" class="form-label mb-1 fs-14px fw-700 required">Role
                  </label>
                  <input type="text" class="form-control fs-14px disabled pointer-none" id="role"
                    placeholder="Enter role" formControlName="role" [readOnly]="true">
                  <!-- <small *ngIf="isControlHasError('role','required', accountDetailsForm)" class="text-danger">First Name
                    is
                    required</small> -->
                </div>

              </div>
              <div class="d-flex justify-content-end mt-4">
                <!-- <button type="button" class="btn border me-3 close-modal" (click)="closeModal()">Cancel</button> -->
                <button type="button" class="primary_button" *ngIf="!isEdited" (click)="isEdited = true">
                  Edit
                </button>

                <button type="button" class="cancel_btn me-2" *ngIf="isEdited" (click)="isEdited = false; ngOnInit()" >
                  Cancel
                </button>
                <button type="submit" class="primary_button" [disabled]="isLoadingAccount" *ngIf="isEdited">
                  <span class="spinner-border spinner-border-sm" *ngIf="isLoadingAccount"></span>
                  Update
                </button>

              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <div id="security-tab" *ngIf="selectedTab === 'security'">
      <div class="main-div w-100 securitys-tab">

        <div class="main-div">
          <h4 class="fs-20px fw-700 mb-3">Security</h4>
          <form [formGroup]="changePasswordForm" (ngSubmit)="onChangePasswordSubmit()" class="">
            <div class="d-block d-md-flex justify-content-between">
              <div class="mb-4 custom-input w-100 me-4 position-relative"
                [ngClass]="isControlHasError('password', 'required', changePasswordForm) ? 'custom-input-error': 'custom-input'">
                <label for="current-password" class="form-label mb-1 fs-14px fw-700 required">Current Password
                </label>
                <input [type]="hideCurrentPassword ? 'password' : 'text'" class="form-control fs-14px"
                  id="current-password" placeholder="Enter current password" formControlName="password">
                <small *ngIf="isControlHasError('password','required', changePasswordForm)"
                  class="mt-1 text-danger">Current password is required</small>
                <i class="eye2 position-absolute" (click)="togglePasswordVisibility(1)"
                  [ngClass]="{'eye-open': !hideCurrentPassword, 'eye-closed': hideCurrentPassword}"></i>
              </div>
              <div class="mb-4 custom-input w-100 me-4 position-relative"></div>
            </div>
            <div class="d-block d-md-flex justify-content-between">
              <div class="mb-4 custom-input w-100 position-relative"
                [ngClass]="isControlHasError('newPassword', 'required', changePasswordForm) || isControlHasError('newPassword', 'pattern', changePasswordForm) ||  isControlHasError('newPassword', 'minlength', changePasswordForm)? 'custom-input-error': 'custom-input'">
                <label for="exampleFormCont" class="form-label mb-1 fs-14px fw-700 required ">New Password
                </label>
                <input [type]="hideNewPassword ? 'password' : 'text'" class="form-control fs-14px" id="exampleFormCont"
                  placeholder="Enter new password" formControlName="newPassword">
                <i class="eye2 position-absolute" (click)="togglePasswordVisibility(2)"
                  [ngClass]="{'eye-open': !hideNewPassword, 'eye-closed': hideNewPassword}"></i>

                  <div [ngSwitch]="true">
                    <div *ngSwitchCase="isControlHasError('newPassword','required', changePasswordForm)">
                      <small class="mt-1 text-danger">Password is required</small>
                    </div>
                    <div *ngSwitchCase="isControlHasError('newPassword', 'pattern', changePasswordForm) && !isControlHasError('newPassword', 'minlength', changePasswordForm)">
                      <small class="mt-1 text-danger">Please choose a stronger password. Try a mix of letters, numbers, and symbols.</small>
                    </div>
                    <div *ngSwitchCase="isControlHasError('newPassword', 'minlength', changePasswordForm)">
                      <small class="mt-1 text-danger">Use 8 or more characters.</small>
                    </div>
                  </div>
                  
              </div>
              <div class="custom-input position-relative"></div>
              <div class="mb-4 custom-input w-100 me-4 ms-0 ms-md-4 pointer-none position-relative"
                [ngClass]="(isControlHasError('confirmPassword', 'required', changePasswordForm) || matchPassword) ? 'custom-input-error': 'custom-input'">
                <label for="confirm-password" class="form-label mb-1 fs-14px fw-700 required">Confirm New
                  Password
                </label>
                <input [type]="hideConfirmNewPassword ? 'password' : 'text'" class="form-control fs-14px"
                  id="confirm-password" placeholder="Retype new password" formControlName="confirmPassword"
                  (keyup)="checkPasswordEquality()">
                <i class="eye2 position-absolute" (click)="togglePasswordVisibility(3)"
                  [ngClass]="{'eye-open': !hideConfirmNewPassword, 'eye-closed': hideConfirmNewPassword}"></i>
                <small *ngIf="isControlHasError('confirmPassword','required', changePasswordForm)"
                  class="mt-1 text-danger">Please confirm new password</small>
                <small *ngIf="matchPassword" class="mt-1 text-danger">Password not matched</small>
              </div>
            </div>
            <div class="d-flex justify-content-end mt-4">
              <!-- <button type="button" class="btn border me-3 close-modal" (click)="closeModal()">Cancel</button> -->
              <button type="submit" class="primary_button" [disabled]="isLoadingPassword">
                <span class="spinner-border spinner-border-sm" *ngIf="isLoadingPassword"></span>
                Change Password
              </button>
            </div>

          </form>
        </div>
      </div>
    </div>

    <div id="security-tab" *ngIf="selectedTab === 'organization'">
      <div class="main-div w-100 organization-tab">
        <div class="main-div mt-1">
          <h4 class="fs-20px fw-700 mb-3">Organization Detail</h4>
          <form [formGroup]="organizationForm" (ngSubmit)="onOrganizationSubmit()" class="">
            <div class="d-block d-md-flex justify-content-between">
              <div class="mb-3 custom-input w-100 me-4">
                <label for="exampleFormControlInput1" class="form-label mb-1 fs-14px fw-700">Name
                </label>
                <input type="text" class="form-control fs-14px" placeholder="Enter Organization name"
                  formControlName="name">

              </div>
              <div class="mb-3 custom-input w-100">
                <label for="exampleFormControlInput1" class="form-label mb-1 fs-14px fw-700 ">Domain
                </label>
                <input type="text" class="form-control fs-14px" placeholder="Enter domain name"
                  formControlName="domain">

              </div>

            </div>
            <div class="d-flex d-md-flex justify-content-end mt-4">
              <button type="submit" class="primary_button" [disabled]="isLoadingOrganization">
                <span class="spinner-border spinner-border-sm" *ngIf="isLoadingOrganization"></span>
                Save
              </button>
            </div>
          </form>
        </div>
      </div>
    </div> 
  </div>